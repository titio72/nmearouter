<!DOCTYPE html>
<html xml:lang="en">


<template id="my-dial">
    <svg width="210" height="210" style="display: block; margin: auto;">
        <circle cx="50%" cy="50%" r="90" stroke="gray" stroke-width="3" fill="#EEEEFF"></circle>

        <path d="M95 95 L105 20 L105 105 Z" fill="#A0A0A0" transform="rotate(45 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#A0C0C0" transform="rotate(45 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#A0A0A0" transform="rotate(135 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#A0C0C0" transform="rotate(135 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#A0A0A0" transform="rotate(225 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#A0C0C0" transform="rotate(225 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#A0A0A0" transform="rotate(315 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#A0C0C0" transform="rotate(315 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#C0A0A0" transform="rotate(0 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#C0C0C0" transform="rotate(0 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#C0A0A0" transform="rotate(90 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#C0C0C0" transform="rotate(90 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#C0A0A0" transform="rotate(180 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#C0C0C0" transform="rotate(180 105 105)"></path>
        <path d="M95 95 L105 20 L105 105 Z" fill="#C0A0A0" transform="rotate(270 105 105)"></path>
        <path d="M105 105 L105 20 L115 95 Z" fill="#C0C0C0" transform="rotate(270 105 105)"></path>

        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3" transform="rotate(0 105 105)">
        </path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(15 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(30 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(45 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(60 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(75 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(90 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(105 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(120 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(135 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(150 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(165 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(180 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(195 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(210 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(225 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(240 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(255 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(270 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(285 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(300 105 105)"></path>
        <path d="M25 105 L45 105" fill="none" stroke="black" stroke-width="3"
              transform="rotate(315 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(330 105 105)"></path>
        <path d="M30 105 L40 105" fill="none" stroke="black" stroke-width="1"
              transform="rotate(345 105 105)"></path>
    </svg>
</template>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Andrea Boni NMEARouter</title>
    <link rel="icon" type="image/png" href="nmeasail.png">
    <script src="js/nmearouter.js?l"></script>
    <link href="css/nmearouter.css" rel="stylesheet"/>
    <style>

    .panelTable {
      width: 100%;
      font-family: monospace;
      font-size: 13pt;
    }

    .card-sensor-text {
      font-family: monospace;
      font-size: 18pt;
    }

    .card-sensor-text-small {
      font-family: monospace;
      font-size: 12pt;
    }

    .card-sensor-body {
      height: 300px;
    }

    .card-sensor {
    }

    .card-sensor-header {
    }
  </style>
</head>
<script type="text/javascript">

  var deliver = false;
  var inView = false;
  window.onfocus = window.onblur = window.onpageshow = window.onpagehide = function (e) {
    if ({focus:1, pageshow:1}[e.type]) {
      if (inView) return;
      inView = true;
      deliver = true;
      console.log("visible");
    } else if (inView) {
      inView = false;
      deliver = false;
      console.log("non-visible");
    }
  }

  app.controller("myCtrl", function ($scope) {
    $scope.V0 = { value: 0.0 };
    $scope.V1 = { value: 0.0 };
  });

  var heading;
  var speed;
  var absoluteWind;
  var trueWind;

  var socket = null;
  $(document).ready(function () {
    window.setInterval(checkConnection, 1000);
  });

  function checkConnection() {
    if (!socket) {
      resetConnection();
    } else if (socket.readyState >= 2) {
      resetConnection();
    }
  }

  function resetConnection() {
    if (socket && socket.readyState < 2 /*OPEN or OPENING*/) {
      socket.close();
    }
    socket = new WebSocket("ws://" + window.location.hostname + ":1112/events");
    socket.onmessage = function (event) {
      if (deliver) {
        processEvent(event);
      }
    }
    socket.onclose = function (event) {
      socketClosed(event);
    }
  }

  function socketClosed(event) {
  }

  function doWithScope(msg, doer) {
      var controllerElement = document.getElementById('sensorPanel');
      var controllerScope = angular.element(controllerElement).scope();
      doer(msg, controllerScope);
      controllerScope.$evalAsync();
  }

  function processEvent(event) {
    var msg = JSON.parse(event.data);
    if (msg.topic == 'nav') {
      var controllerElement = document.getElementById('sensorPanel');
      var controllerScope = angular.element(controllerElement).scope();
      controllerScope.nav_info = msg;
      controllerScope.$evalAsync();
    } else if (msg.topic == 'XDR') {
      for (var prop in msg) {
        if (prop != 'XDR') {
          var controllerElement = document.getElementById('sensorPanel');
          var controllerScope = angular.element(controllerElement).scope();
          controllerScope[prop] = msg[prop];
          controllerScope.$evalAsync();
        }
      }
    } else if (msg.topic == "diagnostic") {
      doWithScope(msg, (m, scope)=>{      
        scope.free_memory = m.free_memory;
        scope.queue = m.queue;
      });
    } else if (msg.topic == "anchor") {
      doWithScope(msg, (m, scope)=>{
        if (m.stationary) {
          m.anchor_lat = m.lat;
          m.anchor_lon = m.lon;
        } else {
          m.anchor_lat = "";
          m.anchor_lon = "";
        }
        scope['xmc'] = m;
      });
    } else if (msg.topic == "engine") {
      doWithScope(msg, (m, scope)=>{scope['engine'] = m;});
    } else if (msg.topic == 'RMC') {
      doWithScope(msg, (m, scope)=>{
        m.s_dir = direction(m.COG);
        m.s_time = new Date(Date.parse(m.UTC)).toLocaleTimeString();
        scope['rmc'] = m;
      });
    } else if (msg.topic == 'DPT') {
      doWithScope(msg, (m, scope)=>{ scope['depth'] = m;});
    } else if (msg.topic == 'VHW') {
      doWithScope(msg, (m, scope)=>{ 
        m.s_dir = direction(m.mag_angle);
        speed = m.speed;
        scope['vector'] = m;
      });
    } else if (msg.topic == 'MWV_R') {
      doWithScope(msg, (m, scope)=>{
        scope['wind_r'] = m;
        if (m.angle > 180) {
          m.show_angle = 360 - m.angle;
          m.tack = "Port"
        } else {
          m.show_angle = m.angle;
          m.tack = "Starboard"
        }

        trueWind = calcTrueWind(speed, m.angle, m.speed);
        trueWind.angle = (360 + trueWind.angle) % 360;
        if (trueWind.angle > 180) {
          trueWind.show_angle = (720 - trueWind.angle) % 360;
          trueWind.tack = "Port"
        } else {
          trueWind.show_angle = trueWind.angle;
          trueWind.tack = "Starboard"
        }
        scope['wind_t'] = trueWind;

        absoluteWind = {
          mag_angle: (heading + trueWind.angle + 360) % 360,
          speed: trueWind.speed,
          s_dir: direction((heading + trueWind.angle) % 360)
        };
        scope['wind'] = absoluteWind;
      });
    } else if (msg.topic == 'heading' && msg.reference == 'Magnetic') {
      doWithScope(msg, (m, scope)=>{
        m.s_dir = direction(m.heading);
        heading = m.heading;
        scope['heading'] = m;
      });
    } else if (msg.topic == "humidity") {
      if (msg.source=="Inside" && msg.instance==0) {
        doWithScope(msg, (m, scope)=>scope["Humidity"] = { value: m.humidity });
      }
    } else if (msg.topic == "pressure") {
      if (msg.source=="Atmospheric" && msg.instance==0) {
        doWithScope(msg, (m, scope)=>scope["Barometer"] = { value: m.pressure });
      }
    } else if (msg.topic == "temperature") {
      if (msg.source=="Sea Temperature" && msg.instance==0) {
        doWithScope(msg, (m, scope)=>scope['WaterTemp'] = m.temperature);
      } else if (msg.source=="Main Cabin Temperature" && msg.instance==0) {
        doWithScope(msg, (m, scope)=>scope['CabinTemp'] = { value: m.temperature });
      } else if (msg.source=="CPU Temperature" && msg.instance==0) {
        doWithScope(msg, (m, scope)=>scope['CPUTemp'] = { value: m.temperature });
      }
    } else if (msg.topic == "attitude") {
      doWithScope(msg, (m, scope)=>{
        scope["YAW"] = { value: m.yaw };
        scope["ROLL"] = { value: m.roll };
        scope["PITCH"] = { value: m.pitch };
      });
    } else if (msg.topic=="RSA" && msg.instance==0) {
      doWithScope(msg, (m, scope)=>{
        m.show_angle0 = m.angle>0?105:(105 + m.angle*105.0/45.0);
        m.show_angle1 = m.angle>0?(105 + m.angle*105.0/45.0):105;
        m.show_side = m.angle>0?"S":"P";
        scope[m.topic] = m;
      });
    } else if (msg.topic=="pilot_mode" || msg.topic=="pilot_wind_datum" || msg.topic=="pilot_locked_heading" || msg.topic=="pilot_heading") {
      doWithScope(msg, (m, scope)=>{
        scope[m.topic] = m;
        if (m.topic=='pilot_mode' && m.mode!='VANE') {
          scope['pilot_wind_datum'] = {
            rolling_average_wind: null,
            wind_datum: null
          };
        } 
        if (m.topic=='pilot_mode' && m.mode!='AUTO') {
          scope['pilot_locked_heading'] = {
            heading_magnetic: null,
            heading_true: null
          }
        }
      });
    }
  }

  function calcTrueWind(speed, appWindDeg, appWindSpeed) {
    v = speed;
    w = appWindSpeed;
    wA = appWindDeg / 180.0 * Math.PI;

    wAx = w * Math.sin(wA);
    wAy = w * Math.cos(wA);

    wTx = wAx;
    wTy = wAy - v;

    a = 180.0 * ((Math.PI / 2) - Math.atan2(wTy, wTx)) / Math.PI;
    var r = {
      angle: a,
      speed: Math.sqrt(wTx * wTx + wTy * wTy),
      show_angle: Math.abs(a)
    }
   return r;
  }

  customElements.define('my-wind-dial', class extends HTMLElement {

    static get observedAttributes() {
      return ['angle_true', 'angle_app'];
    }

    get angle_true() { return this.getAttribute('angle_true'); }
    get angle_app() { return this.getAttribute('angle_app'); }

    connectedCallback() {
      var aT = this.getAttribute('angle_true');
      var aA = this.getAttribute('angle_app');
      aT = (aT==null)?0:aT;
      aA = (aA==null)?0:aA;
      let template = document.getElementById('my-dial');
      let templateContent = template.content;
      let newInstance = templateContent.cloneNode(true);

      let arrowT = document.createElementNS("http://www.w3.org/2000/svg", "path");
      arrowT.setAttributeNS(null, "d", "M95 105 L105 45 L115 105 Z");
      arrowT.setAttributeNS(null, "fill", "blue");
      arrowT.setAttributeNS(null, "stroke", "gray");
      arrowT.setAttributeNS(null, "stroke-width", "3");
      arrowT.setAttributeNS(null, "transform", "rotate(" + aT + " 105 105)");
      newInstance.firstElementChild.appendChild(arrowT);

      let arrowA = document.createElementNS("http://www.w3.org/2000/svg", "path");
      arrowA.setAttributeNS(null, "d", "M95 105 L105 45 L115 105 Z");
      arrowA.setAttributeNS(null, "fill", "lightblue");
      arrowA.setAttributeNS(null, "stroke", "gray");
      arrowA.setAttributeNS(null, "stroke-width", "3");
      arrowA.setAttributeNS(null, "transform", "rotate(" + aA + " 105 105)");
      newInstance.firstElementChild.appendChild(arrowA);

      let arcRed = document.createElementNS("http://www.w3.org/2000/svg", "path");
      arcRed.setAttributeNS(null, "d", "M35 105 A70 70 00 0 1 105 35");
      arcRed.setAttributeNS(null, "fill", "none");
      arcRed.setAttributeNS(null, "stroke", "red");
      arcRed.setAttributeNS(null, "stroke-width", "5");
      arcRed.setAttributeNS(null, "transform", "rotate(0 105 105)");
      newInstance.firstElementChild.appendChild(arcRed);

      let arcGreen = document.createElementNS("http://www.w3.org/2000/svg", "path");
      arcGreen.setAttributeNS(null, "d", "M35 105 A70 70 00 0 1 105 35");
      arcGreen.setAttributeNS(null, "fill", "none");
      arcGreen.setAttributeNS(null, "stroke", "green");
      arcGreen.setAttributeNS(null, "stroke-width", "5");
      arcGreen.setAttributeNS(null, "transform", "rotate(90 105 105)");
      newInstance.firstElementChild.appendChild(arcGreen);

      this.appendChild(newInstance);
    }
  });


  customElements.define('my-dial', class extends HTMLElement {

    static get observedAttributes() {
      return ['angle', 'angle_wind'];
    }

    get angle() {
      return this.getAttribute('angle');
    }

    get angle_wind() {
      return this.getAttribute('angle_wind');
    }

    connectedCallback() {
      var a = this.getAttribute('angle');
      var w = this.getAttribute('angle_wind');
      a = (a==null)?0:a;
      w = (w==null)?0:w;
      let template = document.getElementById('my-dial');
      let templateContent = template.content;
      let newInstance = templateContent.cloneNode(true);

      let arrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
      arrow.setAttributeNS(null, "d", "M95 105 L105 45 L115 105 Z");
      arrow.setAttributeNS(null, "fill", "blue");
      arrow.setAttributeNS(null, "stroke", "gray");
      arrow.setAttributeNS(null, "stroke-width", "3");
      arrow.setAttributeNS(null, "transform", "rotate(" + a + " 105 105)");
      newInstance.firstElementChild.appendChild(arrow);

      let wind_arrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
      wind_arrow.setAttributeNS(null, "d", "M95 105 L105 45 L115 105 Z");
      wind_arrow.setAttributeNS(null, "fill", "yellow");
      wind_arrow.setAttributeNS(null, "stroke", "gray");
      wind_arrow.setAttributeNS(null, "stroke-width", "3");
      wind_arrow.setAttributeNS(null, "transform", "rotate(" + w + " 105 105)");
      newInstance.firstElementChild.appendChild(wind_arrow);

      this.appendChild(newInstance);
      //<path d="M95 105 L105 45 L115 105 Z" fill="blue" stroke="gray" stroke-width="3" transform="rotate({{hdm.angle}} 105 105)"></path>
    }
  });

function setAP(apCommand) {
  var xmlHttp = new XMLHttpRequest();
  xmlHttp.open("GET", "http://" + window.location.hostname + ":1112/ap?command=" + apCommand,
      false);
  xmlHttp.setRequestHeader('Content-Type', 'text/plain');
  xmlHttp.send(null);
  return JSON.parse(xmlHttp.responseText);
}
</script>

<body ng-app="nmearouter">
<div id="nmearouter" class="container-fluid">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item active">Sensors</li>
    </ol>
    <div id="sensorPanel" ng-controller="myCtrl">
        <div class="row">
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">Heading</div>
                    <div class="card-router-body card-sensor-body">
                        <table width="100%">
                            <tr>
                                <td>
                                    <div class="card-sensor-text-small">Head {{heading.heading|numberFixedLen:3:0}}&deg;
                                        {{heading.s_dir}}<br>
                                        Wind {{wind.speed | number:1}}Kn {{wind.mag_angle |
                                        numberFixedLen:3:0}}&deg;
                                        {{wind.s_dir}}
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: center;">
                                    <my-dial angle="{{heading.heading}}"
                                             angle_wind="{{wind.mag_angle}}"></my-dial>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">Rel. Wind</div>
                    <div class="card-router-body card-sensor-body">
                        <table width="100%">
                            <tr>
                                <td>
                                    <div class="card-sensor-text-small">A {{wind_r.speed | number:1}}Kn
                                        {{wind_r.show_angle | numberFixedLen:3:0}}&deg;
                                        {{wind_r.tack}}<br>
                                        T {{wind_t.speed | number:1}}Kn
                                        {{wind_t.show_angle|numberFixedLen:3:0}}&deg;<br>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: center;">
                                    <my-wind-dial angle_app="{{wind_r.angle}}"
                                                  angle_true="{{wind_t.angle}}"></my-wind-dial>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">GPS</div>
                    <div class="card-router-body card-sensor-body">
                        <table class="panelTable">
                            <tr>
                                <td>Position</td>
                                <td style="text-align: right">{{rmc.latitude}}</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td style="text-align: right">{{rmc.longitude}}</td>
                            </tr>
                            <tr>
                                <td>Anchor</td>
                                <td style="text-align: right">{{xmc.anchor_lat}}</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td style="text-align: right">{{xmc.anchor_lon}}</td>
                            </tr>
                            <tr>
                                <td>SOG</td>
                                <td style="text-align: right">{{rmc.SOG | number:1}} Kn</td>
                            </tr>
                            <tr>
                                <td>COG</td>
                                <td style="text-align: right">{{rmc.s_dir}} {{rmc.COG | number:1}}&deg;</td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: right">{{rmc.s_time}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">Waypoint</div>
                    <div class="card-router-body card-sensor-body">
                        <table class="panelTable">
                            <tr>
                                <td>Destination</td>
                                <td style="text-align: right">{{nav_info.waypoint.latitude}}</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td style="text-align: right">{{nav_info.waypoint.longitude}}</td>
                            </tr>
                            <tr>
                                <td>BTW/DTW</td>
                                <td style="text-align: right">{{nav_info.btw | number:1}}&deg; {{nav_info.dtw |
                                    number:2}} NM
                                </td>
                            </tr>
                            <tr>
                                <td>VMG</td>
                                <td style="text-align: right">{{nav_info.vmg | number:1}} KN</td>
                            </tr>
                            <tr>
                                <td>ETA</td>
                                <td style="text-align: right">{{nav_info.eta_date}}</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td style="text-align: right">{{nav_info.eta_time}}</td>
                            </tr>
                            <tr>
                                <td>Time</td>
                                <td style="text-align: right">{{nav_info.time_to_dest}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">Navi</div>
                    <div class="card-router-body card-sensor-body">
                        <table class="panelTable">
                          <tr>
                              <td>Speed</td>
                              <td style="text-align: right">{{vector.speed | number:1}} Kn</td>
                          </tr>
                          <tr>
                              <td>Head (mag)</td>
                              <td style="text-align: right">{{vector.s_dir}} {{vector.mag_angle | number:1}}&deg;
                              </td>
                          </tr>
                          <tr>
                              <td>&nbsp;</td>
                              <td style="text-align: right">&nbsp;</td>
                          </tr>
                          <tr>
                              <td>Depth</td>
                              <td style="text-align: right">{{depth.depth | number:1}} m</td>
                          </tr>
                          <tr>
                              <td>&nbsp;</td>
                              <td style="text-align: right">&nbsp;</td>
                          </tr>
                          <tr>
                              <td>Head</td>
                              <td style="text-align: right">{{YAW.value | number:1}}&deg;</td>
                          </tr>
                          <tr>
                              <td>Roll</td>
                              <td style="text-align: right">{{ROLL.value | number:1}}&deg;</td>
                          </tr>
                          <tr>
                              <td>Pitch</td>
                              <td style="text-align: right">{{PITCH.value | number:1}}&deg;</td>
                          </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">Diag</div>
                    <div class="card-router-body card-sensor-body">
                        <table class="panelTable">
                            <tr>
                                <td>Battery Svc</td>
                                <td style="text-align: right">{{V0.value | number:1}} V</td>
                            </tr>
                            <tr>
                                <td>Battery Eng</td>
                                <td style="text-align: right">{{V1.value | number:1}} V</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td style="text-align: right">&nbsp;</td>
                            </tr>
                            <tr>
                                <td>CPU</td>
                                <td style="text-align: right">{{CPUTemp.value | number:1}} &deg;C</td>
                            </tr>
                            <tr>
                                <td>Equipment</td>
                                <td style="text-align: right">{{AirTemp.value | number:1}} &deg;C</td>
                            </tr>
                            <tr>
                                <td>Engine</td>
                                <td style="text-align: right">{{EngineTemp.value | number:1}} &deg;C</td>
                            </tr>
                            <tr>
                                <td>Queue</td>
                                <td style="text-align: right">{{queue}} Msg</td>
                            </tr>
                            <tr>
                                <td>Free Memory</td>
                                <td style="text-align: right">{{free_memory}} MB</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                <div class="card-router card-sensor">
                    <div class="card-router-header card-sensor-header">Meteo</div>
                    <div class="card-router-body card-sensor-body">
                        <table class="panelTable">
                            <tr>
                                <td>Cab Temp</td>
                                <td style="text-align: right">{{CabinTemp.value | number:1}} &deg;C</td>
                            </tr>
                            <tr>
                                <td>Water Temp</td>
                                <td style="text-align: right">{{WaterTemp | number:1}} &deg;C</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td style="text-align: right">&nbsp;</td>
                            </tr>
                            <tr>
                                <td>Press.</td>
                                <td style="text-align: right">{{Barometer.value | number:1}} MB</td>
                            </tr>
                            <tr>
                                <td>Humidity</td>
                                <td style="text-align: right">{{Humidity.value | number:1}}%</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
              <div class="card-router card-sensor">
                  <div class="card-router-header card-sensor-header">Pilot</div>
                  <div class="card-router-body card-sensor-body">
                      <table class="panelTable">
                        <tr>
                          <td>Mode</td>
                          <td style="text-align: right">{{pilot_mode.mode}}</td>
                        </tr>
                        <tr>
                          <td>Wind Datum</td>
                          <td style="text-align: right">{{pilot_wind_datum.wind_datum_view | number:0}}&deg; {{pilot_wind_datum.wind_datum_side}}</td>
                        </tr>
                        <tr>
                          <td>Wind Average</td>
                          <td style="text-align: right">{{pilot_wind_datum.rolling_average_wind_view | number:0}}&deg; {{pilot_wind_datum.rolling_average_wind_side}}</td>
                        </tr>
                        <tr>
                          <td>Heading</td>
                          <td style="text-align: right">{{pilot_heading.heading_magnetic | number:0}}&deg;</td>
                        </tr>
                        <tr>
                          <td>Lock Heading</td>
                          <td style="text-align: right">{{pilot_locked_heading.heading_magnetic | number:0}}&deg;</td>
                        </tr>
                      </table>
                      <table class="panelTable">
                        <tr>                          
                          <td colspan="4"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('STANDBY')">Standby</button></td>
                          <td colspan="4"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('AUTO')">Auto</button></td>
                          <td colspan="4"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('VANE')">Vane</button></td>
                        </tr>
                        <tr>                          
                          <td colspan="3"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('P10')">&minus;10</button></td>
                          <td colspan="3"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('P1')">&minus;1</button></td>
                          <td colspan="3"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('S1')">&plus;1</button></td>
                          <td colspan="3"><button type="button" class="btn btn-secondary tile-button" style="width: 100%;" onclick="setAP('S10')">&plus;10</button></td>
                        </tr>
                      </table>
                      <div style="margin: 5px;">
                        <svg width="210" height="20" style="display: block; margin: auto;">
                          <path d="M0 0 L210 0 L210 20 L0 20 Z" fill="white"></path>
                          <path d="M{{RSA.show_angle0}} 0 L{{RSA.show_angle1}} 0 L{{RSA.show_angle1}} 20 L{{RSA.show_angle0}} 20 Z" fill="red"></path>
                          <path d="M35 0 L35 20" stroke="black" stroke-width="1"></path>
                          <path d="M70 0 L70 20" stroke="black" stroke-width="1"></path>
                          <path d="M105 0 L105 20" stroke="black" stroke-width="1"></path>
                          <path d="M140 0 L140 20" stroke="black" stroke-width="1"></path>
                          <path d="M175 0 L175 20" stroke="black" stroke-width="1"></path>
                          <path d="M175 0 L175 20" stroke="black" stroke-width="1"></path>
                        </svg>
                      </div>
                  </div>
              </div>
            </div>
       </div>
    </div>
</div>
</body>

</html>
